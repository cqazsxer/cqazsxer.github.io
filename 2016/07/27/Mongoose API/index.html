<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.4.0 -->
    <script>window.materialVersion = "1.4.0"</script>

    <!-- Title -->
    
    <title>
        
            Mongoose API | 
        
        (　ﾟ∀ﾟ) ﾉ♡
    </title>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    
    
    
    
    

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Feng">
    <meta name="description" itemprop="description" content="Mongoose API标签（空格分隔）： mongodb 

快速入门入门首先确认你安装了 MongoDB 和 Node.js。然后用 npm 从命令行安装 mongoose：1$ npm install mongoose
现在说我们喜欢毛茸茸的小猫，希望在 MongoDB 中记录每一个遇到的小猫。第一件需要做的就是在项目中引用 mongoose，然后在本地的 MongoDB 的实例中的test数据库打开一个连接。123// getting-started.jsvar mongoose = require(&#39;mongoose&#39;);mongoose.connect(&#39;mongodb://localhost/test&#39;);
我们有了一个运行在本地、连接被挂起的test服务器。现在我们可以得知服务器是否连接成功或者报错：12345var db = mongoose.connection;db.on(&#39;error&#39;, console.error.bind(console, &#39;connection error:&#39;));db.once(&#39;open&#39;, function (callback) &amp;#123;  // yay!&amp;#125;);">
    <meta name="keywords" content="null">

    <!-- Site Verification -->
    
    

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="(　ﾟ∀ﾟ) ﾉ♡">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Mongoose API | (　ﾟ∀ﾟ) ﾉ♡">
    <meta property="og:image" content="/img/favicon.png" />
    <meta property="og:description" content="Mongoose API标签（空格分隔）： mongodb 

快速入门入门首先确认你安装了 MongoDB 和 Node.js。然后用 npm 从命令行安装 mongoose：1$ npm install mongoose
现在说我们喜欢毛茸茸的小猫，希望在 MongoDB 中记录每一个遇到的小猫。第一件需要做的就是在项目中引用 mongoose，然后在本地的 MongoDB 的实例中的test数据库打开一个连接。123// getting-started.jsvar mongoose = require(&#39;mongoose&#39;);mongoose.connect(&#39;mongodb://localhost/test&#39;);
我们有了一个运行在本地、连接被挂起的test服务器。现在我们可以得知服务器是否连接成功或者报错：12345var db = mongoose.connection;db.on(&#39;error&#39;, console.error.bind(console, &#39;connection error:&#39;));db.once(&#39;open&#39;, function (callback) &amp;#123;  // yay!&amp;#125;);">
    

    
        <meta property="article:published_time" content="7月 27, 2016" />
        <meta property="article:modified_time" content="3月 23, 2018" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="Mongoose API | (　ﾟ∀ﾟ) ﾉ♡">
    <meta name="twitter:description" content="Mongoose API标签（空格分隔）： mongodb 

快速入门入门首先确认你安装了 MongoDB 和 Node.js。然后用 npm 从命令行安装 mongoose：1$ npm install mongoose
现在说我们喜欢毛茸茸的小猫，希望在 MongoDB 中记录每一个遇到的小猫。第一件需要做的就是在项目中引用 mongoose，然后在本地的 MongoDB 的实例中的test数据库打开一个连接。123// getting-started.jsvar mongoose = require(&#39;mongoose&#39;);mongoose.connect(&#39;mongodb://localhost/test&#39;);
我们有了一个运行在本地、连接被挂起的test服务器。现在我们可以得知服务器是否连接成功或者报错：12345var db = mongoose.connection;db.on(&#39;error&#39;, console.error.bind(console, &#39;connection error:&#39;));db.once(&#39;open&#39;, function (callback) &amp;#123;  // yay!&amp;#125;);">
    <meta name="twitter:image" content="/img/favicon.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="http://yoursite.com" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://yoursite.com/2016/07/27/Mongoose API/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "(　ﾟ∀ﾟ) ﾉ♡",
        "logo": "/img/favicon.png"
    },
    "author": {
        "@type": "Person",
        "name": "Feng",
        "image": {
            "@type": "ImageObject",
            "url": "/img/favicon.png"
        },
        "description": "Hi, nice to meet you"
    },
    "headline": "Mongoose API",
    "url": "http://yoursite.com/2016/07/27/Mongoose API/index.html",
    "datePublished": "7月 27, 2016",
    "dateModified": "3月 23, 2018",
    "description": "Mongoose API标签（空格分隔）： mongodb 

快速入门入门首先确认你安装了 MongoDB 和 Node.js。然后用 npm 从命令行安装 mongoose：1$ npm install mongoose
现在说我们喜欢毛茸茸的小猫，希望在 MongoDB 中记录每一个遇到的小猫。第一件需要做的就是在项目中引用 mongoose，然后在本地的 MongoDB 的实例中的test数据库打开一个连接。123// getting-started.jsvar mongoose = require(&#39;mongoose&#39;);mongoose.connect(&#39;mongodb://localhost/test&#39;);
我们有了一个运行在本地、连接被挂起的test服务器。现在我们可以得知服务器是否连接成功或者报错：12345var db = mongoose.connection;db.on(&#39;error&#39;, console.error.bind(console, &#39;connection error:&#39;));db.once(&#39;open&#39;, function (callback) &amp;#123;  // yay!&amp;#125;);",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://yoursite.com"
    }
}
</script>


    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+materialVersion+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(data&&data.indexOf(versionString)===-1){lsloader.removeLS(key)}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload){cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload);return}code=code.split(versionString)[1];if(/\.js?.+$/.test(versionNumber)){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload)}};lsloader.requestResource=function(name,path,cssonload){var that=this;if(/\.js?.+$/.test(path)){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else if(/\.css?.+$/.test(path)){this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import CSS & jQuery -->
    
        <style id="css/material.min.css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("css/material.min.css","/css/material.min.css?fJTiM/K1J3dWIruo3pxtAw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";})</script>
        <style id="css/style.min.css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("css/style.min.css","/css/style.min.css?oCSEO3ST+aEypEwttTDI9g==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";})</script>
        
        
            <style>
    
    .footer-sns-facebook {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNiA3OGMtMjIuNCA1LjItNTUuOCA0MC4yLTYwLjYgNjMuNC0xLjQgNi40LTIgMTI5LjgtMS42IDM2Ny42LjYgMjk4LjYgMSAzNTguOCAzLjQgMzYzIDExIDIwLjIgMjEuNiAzMi40IDM3LjIgNDMgMTUgMTAuMiAxNy40IDExLjIgMzMgMTMgMTEuMiAxLjQgMTM2IDIgMzY1IDEuNiAzMTQtLjYgMzQ4LjYtMSAzNTUtMy44IDE1LjgtNy4yIDMzLjgtMjIgNDMuMi0zNS40IDUuMi03LjQgMTAuOC0xNi42IDEyLjYtMjAuNCAyLjgtNi40IDMuMi00MC44IDMuOC0zNTQgLjQtMjIzLS4yLTM1My40LTEuNC0zNjUtMi0xNy0yLjYtMTguNi0xMy0zNC04LjYtMTIuNi0xNC4yLTE4LjQtMjUuMi0yNS44LTcuOC01LjQtMTcuNC0xMS0yMS42LTEyLjQtNi0yLjItNzIuOC0yLjYtMzY1LjQtMi42LTE5Ni44LjItMzYxIC44LTM2NC40IDEuOHptNjU3LjYgODcuOGw0LjggMy44djU1LjJjMCA1NC42IDAgNTUuMi00LjYgNTkuNi00LjQgNC40LTYgNC42LTUwLjIgNS42bC00NS42IDEtNy4yIDUuNmMtMTAuNCA4LTE2LjggMTcuMi0xOS4yIDI3LjQtMSA1LTEuOCAyNC44LTEuOCA0NCAuMiAzOCAxLjYgNDQuNiAxMC44IDQ4IDIuOCAxLjIgMjguNCAyIDU2LjggMiA0Ny44IDAgNTIgLjIgNTYuMiAzLjhsNC44IDMuOHY1NS4yYzAgNTQuNiAwIDU1LjItNC42IDU5LjYtNC40IDQuNi01LjQgNC42LTU3IDUuMi0yOC44LjItNTQuNC44LTU2LjggMS40LTIuNC42LTUuNiAzLTYuOCA1LjQtMS44IDMuMi0yLjQgNDEuNC0yLjYgMTQzLjJsLS4yIDEzOC44LTUuNiA0LjgtNS42IDQuOEg2MDljLTUyLjQgMC01Mi44IDAtNTguMi00LjZsLTUuNC00LjYtLjItMTQwLjYtLjItMTQwLjYtNC44LTMuOGMtNC4yLTMuNC04LTMuOC0zNS42LTMuOC0zMi44IDAtNDEtMS44LTQzLjYtMTAtLjYtMi4yLTEuMi0yNS40LTEuMi01MS40IDAtNjAuOC0uMi01NyAzLjQtNjEuNiAyLjgtMy42IDYtNCAzNy44LTUgMzMtMSAzNS4yLTEuMiAzOS40LTUuNiA0LjYtNC40IDQuNi01LjIgNS44LTcxIDEuMi03My40LjItNjcuMiAxNi42LTk5LjQgOC0xNS44IDEyLjgtMjIgMjgtMzcgMTUuMi0xNS4yIDIxLjQtMTkuNiAzOC4yLTI4IDExLTUuNCAyNC0xMSAyOS0xMi4yIDYuMi0xLjggMjguNi0yLjYgNzEuMi0yLjYgNTguNi0uMiA2Mi42IDAgNjcgMy42eiIvPjwvc3ZnPg==);
    }
    
    
    .footer-sns-twitter {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNiA3OGMtMjIuNCA1LjItNTUuOCA0MC4yLTYwLjYgNjMuNC0xLjQgNi40LTIgMTI5LjgtMS42IDM2Ny42LjYgMjk4LjYgMSAzNTguOCAzLjQgMzYzIDExIDIwLjIgMjEuNiAzMi40IDM3LjIgNDMgMTUgMTAuMiAxNy40IDExLjIgMzMgMTMgMTEuMiAxLjQgMTM2IDIgMzY1IDEuNiAzMTQtLjYgMzQ4LjYtMSAzNTUtMy44IDE1LjgtNy4yIDMzLjgtMjIgNDMuMi0zNS40IDUuMi03LjQgMTAuOC0xNi42IDEyLjYtMjAuNCAyLjgtNi40IDMuMi00MC44IDMuOC0zNTQgLjQtMjIzLS4yLTM1My40LTEuNC0zNjUtMi0xNy0yLjYtMTguNi0xMy0zNC04LjYtMTIuNi0xNC4yLTE4LjQtMjUuMi0yNS44LTcuOC01LjQtMTcuNC0xMS0yMS42LTEyLjQtNi0yLjItNzIuOC0yLjYtMzY1LjQtMi42LTE5Ni44LjItMzYxIC44LTM2NC40IDEuOHptNTMyLjggMjA1YzEwIDQgMjMgMTAuOCAyOC44IDE1LjIgMTIuNiA5LjIgMTYuNiAxMC42IDI5LjQgOS40IDYuNi0uNiAxMy0zLjIgMjAuNC04LjIgMTEuMi03LjYgMTkuNC05LjIgMjMuNi01IDMuNiAzLjYgMi44IDktMi44IDE4LjYtNy4yIDEyLjQtNiAxOC44IDQuMiAyNC4yIDQuNCAyLjIgOC4yIDUuNiA4LjYgNy40IDEgNC44LTEyLjYgMjQuMi0yMiAzMS44LTExLjggOS4yLTE3LjIgMjIuNi0xOS42IDQ3LjgtNC44IDUwLjQtNy44IDY2LjYtMTYuNCA4NS40LTMgNy03IDE3LjgtOC44IDI0LTEuOCA2LjQtNSAxNC42LTcuNCAxOC40LTIuMiAzLjgtNy40IDEzLTExLjQgMjAuNC0xNy4yIDMwLjgtNDMuNCA2MS40LTcxLjQgODMuOC0yNS42IDIwLjQtNDYgMzMuMi02NC4yIDQwLjItOC40IDMuMi0xOCA3LjYtMjEuNCA5LjYtNy40IDQuNi0yMi40IDguNi01Ny4yIDE1LTYyLjIgMTEuNi03OS4yIDExLjQtMTM1LjYtMS0zMi40LTctMzguNi05LTUyLTE2LjgtMjEuNC0xMi42LTI0LjItMTQuOC0yNC4yLTE5LjQgMC02LjIgMTAuMi05LjIgMzUtMTAuNCAyMi40LTEgMjguNi0yLjYgNTctMTQuMiAyMy44LTkuOCAyOS40LTEyLjggMzAuNC0xNi44IDIuMi04LjItMy0xMy4yLTI2LjgtMjUuNC0yNS44LTEzLjItMzIuMi0xOC40LTQzLjgtMzUuOC05LTEzLjYtMTAtMjEuMi0zLjYtMzMuNiA1LjQtMTAuOCAzLjYtMTUtMTEuOC0yNS40LTktNi0xNC0xMS42LTIwLjgtMjIuNi0yMy40LTM3LjgtMjUtNTAuOC03LjItNTkuOCA0LjgtMi40IDkuNC01LjQgMTAuMi02LjYgMi44LTQuMi0uNC0xNS42LTguNC0yOS0xMS42LTE5LjYtMTMuMi0yNS44LTEzLjItNTUuMiAwLTI4LjggMi42LTM3LjggMTItNDAuMiA5LTIuMiAxNC44IDEgMzUuNiAyMC4yIDI0LjggMjIuOCA0My42IDM2LjYgNjIuOCA0NS44IDggMy44IDE3LjggOS4yIDIyIDEyIDQuMiAyLjggMTQuOCA3IDIzLjQgOS4yIDguNiAyLjIgMjQuMiA2LjggMzQuOCAxMC4yIDEzLjQgNC40IDIzLjYgNi40IDMzIDYuNiAxMi44LjIgMTQuMi0uMiAxOC42LTUuNCA0LTQuOCA0LjgtNy44IDQuOC0xOS4yIDAtMTQuNCA1LjYtMzkuNiAxMS4yLTUwLjYgNC4yLTguNCAyOS4yLTM0LjIgMzkuOC00MS40IDcuOC01LjQgMzUuNi0xNiA1Mi0yMCAxNC4yLTMuNiAzMi42LTEuMiA1Mi40IDYuOHoiLz48L3N2Zz4=);
    }
    
    
    .footer-sns-gplus {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNiA3OGMtMjIuNCA1LjItNTUuOCA0MC4yLTYwLjYgNjMuNC0xLjQgNi40LTIgMTI5LjgtMS42IDM2Ny42LjYgMjk4LjYgMSAzNTguOCAzLjQgMzYzIDExIDIwLjIgMjEuNiAzMi40IDM3LjIgNDMgMTUgMTAuMiAxNy40IDExLjIgMzMgMTMgMTEuMiAxLjQgMTM2IDIgMzY1IDEuNiAzMTQtLjYgMzQ4LjYtMSAzNTUtMy44IDE1LjgtNy4yIDMzLjgtMjIgNDMuMi0zNS40IDUuMi03LjQgMTAuOC0xNi42IDEyLjYtMjAuNCAyLjgtNi40IDMuMi00MC44IDMuOC0zNTQgLjQtMjIzLS4yLTM1My40LTEuNC0zNjUtMi0xNy0yLjYtMTguNi0xMy0zNC04LjYtMTIuNi0xNC4yLTE4LjQtMjUuMi0yNS44LTcuOC01LjQtMTcuNC0xMS0yMS42LTEyLjQtNi0yLjItNzIuOC0yLjYtMzY1LjQtMi42LTE5Ni44LjItMzYxIC44LTM2NC40IDEuOHpNNDMwIDI5NS40YzQwLjYgMTUuNCA1Ni42IDIzLjggNzIuNiAzOC40IDYuOCA2LjIgNy4yIDE1LjIgMSAyMy40LTYuMiA4LTMzLjYgMzMuOC0zOSAzNi42LTUuNiAyLjgtMTcuNiAyLjgtMjMuMi0uMi0yLjQtMS4yLTguMi01LjItMTMtOC44LTExLjItOC42LTI0LjYtMTEuMi01NS4yLTExLjItMjcuNCAwLTQwLjYgMi42LTUyLjIgMTAuNC00LjQgMi44LTEyLjIgNy42LTE3LjIgMTAuNi0yMyAxMy4yLTUxLjQgNTUtNTUuOCA4Mi40LTIuNiAxNS42LTIuNCAzNC44LjIgNTEgMi44IDE3LjQgMTkuOCA0OC44IDM1LjIgNjUuMiAxNiAxNi42IDQ1IDMzLjYgNjIuOCAzNi42IDI2LjggNC40IDY1LjggMS42IDc5LjQtNS44IDIwLjYtMTEuNCAzMS0xOSA0MS0zMC40IDE4LjgtMjEuNiAyMy40LTM0LjIgMTUuNi00My44LTMuOC00LjgtNC40LTQuOC01MS01LjgtNjAuOC0xLjItNTYuMiAyLjItNTYuMi00My4yIDAtMzIuNC4yLTMzLjIgNC44LTM3IDQuNC0zLjYgOS0zLjggOTItMy44IDc5IDAgODcuOC40IDk0LjIgMy42IDExLjIgNS42IDEzIDExLjQgMTIuOCA0My40IDAgMjUuNC0uOCAzMC44LTcuNiA1OC00IDE2LjYtOS44IDM0LTEyLjYgMzktMi44IDUtOC4yIDE0LjItMTEuNiAyMC42LTguNCAxNS40LTI3LjIgMzYuOC00MC44IDQ2LjYtNS44IDQuNC0xMy44IDEwLjItMTcuNiAxMy4yLTMuOCAzLTExIDctMTYuMiA4LjgtNS4yIDEuOC0xNi4yIDYuNC0yNC40IDEwLTIyLjQgOS42LTM0LjggMTEuNi03MyAxMS42LTM3LjYuMi00Ny0xLjQtNzEtMTItOC4yLTMuNi0xNy42LTcuMi0yMC44LTgtMTUuOC0zLjgtNjctNDUuMi03Ny44LTYyLjgtMi4yLTMuOC03LjYtMTEuNi0xMS44LTE3LjItNC4yLTUuNC05LTE0LTEwLjYtMTktMS44LTQuOC02LjItMTYtMTAtMjQuOC0zLjYtOC44LTcuOC0yMi4yLTkuMi0yOS42LTMuMi0xOC44LTEuNC03OS40IDIuOC05MS40IDEzLjgtNDAuNiAzNS42LTc4IDU4LjgtMTAwLjIgMTQtMTMuNiA0Ny4yLTM2LjQgNTgtMzkuOCA0LjItMS40IDEzLjQtNS4yIDIwLjYtOC40IDIyLTEwIDMyLjgtMTEuNiA3Ni0xMSAzMy44LjYgNDAuNCAxLjIgNTAgNC44em0zNDAuOCA4MC44YzggMy42IDkuNiAxMS4yIDkuMiAzOS4yLS42IDM0LjQtLjYgMzQgNSAzOS42IDQuOCA1IDUuNCA1IDM3LjYgNSA0My40IDAgNDQuNC44IDQzLjIgMzYuMi0uOCAxNy0xLjIgMTguNC02LjQgMjMtNS40IDQuNi02LjYgNC44LTM3LjYgNC44LTMxLjIgMC0zMiAuMi0zNi44IDUtNS42IDUuNC01LjYgNC40LTUgNDEuMi40IDI2LjQuMiAyNy40LTQuNiAzMy00LjggNS42LTYgNS44LTI0LjQgNi40LTIwLjguOC0yOS42LTEuNC0zMy40LTguNC0xLjQtMi42LTItMTUuNi0xLjgtMzUuNi40LTMxLjIuNC0zMS42LTQuNi0zNi42cy01LjYtNS0zNi01Yy0xOC44IDAtMzMtLjgtMzYtMi4yLTcuNi0zLjYtOS42LTExLjItOC44LTMzLjguOC0yOC4yLjQtMjggNDEtMjggNDUuNCAwIDQ1LjQgMCA0NC42LTQyLjYtLjYtMzMtLjYtMzMgNS0zOC40IDQuNC00LjYgNi4yLTUgMjQuOC01IDExIDAgMjIuMiAxIDI1IDIuMnoiLz48L3N2Zz4=);
    }
    
    
    
    
    
    
    
    
    
</style>

        
        <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"rel="stylesheet">


        <script>lsloader.load("js/jquery.min.js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==")</script>
    
    
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Analytics -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    
    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Mongoose-API"><span class="post-toc-number">1.</span> <span class="post-toc-text">Mongoose API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#快速入门"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">快速入门</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#入门"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">入门</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#导航"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">导航</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Schemas"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">Schemas</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#定义Schema"><span class="post-toc-number">1.2.1.1.</span> <span class="post-toc-text">定义Schema</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#创建Model"><span class="post-toc-number">1.2.1.2.</span> <span class="post-toc-text">创建Model</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#实例方法-Instance-methods"><span class="post-toc-number">1.2.1.3.</span> <span class="post-toc-text">实例方法(Instance methods)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#静态方法-Statics"><span class="post-toc-number">1.2.1.4.</span> <span class="post-toc-text">静态方法(Statics)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#索引（Indexes）"><span class="post-toc-number">1.2.1.5.</span> <span class="post-toc-text">索引（Indexes）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#虚拟属性（Virtuals）"><span class="post-toc-number">1.2.1.6.</span> <span class="post-toc-text">虚拟属性（Virtuals）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#可配置项（Options）"><span class="post-toc-number">1.2.1.7.</span> <span class="post-toc-text">可配置项（Options）</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Models"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">Models</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#编译model"><span class="post-toc-number">1.2.2.1.</span> <span class="post-toc-text">编译model</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#生成document"><span class="post-toc-number">1.2.2.2.</span> <span class="post-toc-text">生成document</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Documents"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">Documents</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Sub-Docs"><span class="post-toc-number">1.2.4.</span> <span class="post-toc-text">Sub Docs</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Queries"><span class="post-toc-number">1.2.5.</span> <span class="post-toc-text">Queries</span></a></li></ol></li></ol></li></ol>
        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>
    





<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                Mongoose API
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Feng</strong>
        <span>7月 27, 2016</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Mongoose API&url=http://yoursite.com/2016/07/27/Mongoose API/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    

    <!-- Share Facebook -->
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=(　ﾟ∀ﾟ) ﾉ♡&title=Mongoose API&summary=null&pics=http://yoursite.com/img/favicon.png&url=http://yoursite.com/2016/07/27/Mongoose API/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h1 id="Mongoose-API"><a href="#Mongoose-API" class="headerlink" title="Mongoose API"></a><strong>Mongoose API</strong></h1><p>标签（空格分隔）： mongodb </p>
<hr>
<h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><h3 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h3><p><em>首先确认你安装了 <code>MongoDB</code> 和 <code>Node.js</code></em>。<br>然后用 <code>npm</code> 从命令行安装 <code>mongoose</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install mongoose</span><br></pre></td></tr></table></figure></p>
<p>现在说我们喜欢毛茸茸的小猫，希望在 <code>MongoDB</code> 中记录每一个遇到的小猫。第一件需要做的就是在项目中引用 <code>mongoose</code>，然后在本地的 <code>MongoDB</code> 的实例中的test数据库打开一个连接。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// getting-started.js</span></span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line">mongoose.connect(<span class="string">'mongodb://localhost/test'</span>);</span><br></pre></td></tr></table></figure></p>
<p>我们有了一个运行在本地、连接被挂起的test服务器。现在我们可以得知服务器是否连接成功或者报错：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> db = mongoose.connection;</span><br><span class="line">db.on(<span class="string">'error'</span>, <span class="built_in">console</span>.error.bind(<span class="built_in">console</span>, <span class="string">'connection error:'</span>));</span><br><span class="line">db.once(<span class="string">'open'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// yay!</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>一旦打开连接，callback将会被触发。为简洁起见，我们假设接下来的代码都不带有此callback。</p>
<p>在 Mongoose 中, 一切源于 <strong><code>Schema</code></strong>。下面让我们来引用他并定义一个kittens:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> kittySchema = mongoose.Schema(&#123;</span><br><span class="line">    name: <span class="built_in">String</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>我们得到了有一个字段的 <code>Schema</code> ,类型为 String , 字段名为  name。下面由该 <code>Schema</code> 发布一个 <code>model</code> 。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Kitten = mongoose.model(<span class="string">'Kitten'</span>, kittySchema)</span><br></pre></td></tr></table></figure></p>
<p><code>model</code> 是一个用来创建<code>document</code>的 类。这样的话，每个<code>document</code>将会是一个具有抽象属性和行为的数据库操作的 <code>Kitten</code> 对象。下面创建一个<code>Kitten</code>的 <code>document</code> 实例来标识刚刚散步遇到的小猫吧：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> silence = <span class="keyword">new</span> Kitten(&#123; <span class="attr">name</span>: <span class="string">'Silence'</span> &#125;)</span><br><span class="line"><span class="built_in">console</span>.log(silence.name) <span class="comment">// 'Silence'</span></span><br></pre></td></tr></table></figure></p>
<p>小猫可以喵喵叫，下面展示了如何为 <code>document</code> 添加 <code>speak</code>方法。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> methods must be added to the Schema before compiling it with mongoose.model()</span></span><br><span class="line">kittySchema.methods.speak = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> greeting = <span class="keyword">this</span>.name</span><br><span class="line">    ? <span class="string">"Meow name is "</span> + <span class="keyword">this</span>.name</span><br><span class="line">    : <span class="string">"I don't have a name"</span></span><br><span class="line">  <span class="built_in">console</span>.log(greeting);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Kitten = mongoose.model(<span class="string">'Kitten'</span>, kittySchema)</span><br></pre></td></tr></table></figure></p>
<p>添加到 <code>Schema</code> 的 <code>method</code>属性中的方法，将被编译到到 <code>model</code> 原型中去并暴露在 <code>document</code> 实例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fluffy = <span class="keyword">new</span> Kitten(&#123; <span class="attr">name</span>: <span class="string">'fluffy'</span> &#125;);</span><br><span class="line">fluffy.speak() <span class="comment">// "Meow name is fluffy"</span></span><br></pre></td></tr></table></figure></p>
<p>现在有了可以喵喵叫的小猫！但是我们尚未在 MongoDB 中储存任何数据。每个 <code>document</code> 实例可以调用 自身的<strong><code>save</code></strong>方法存入数据库。<code>callback</code> 的第一个参数是发生错误时的返回码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fluffy.save(<span class="function"><span class="keyword">function</span> (<span class="params">err, fluffy</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">  fluffy.speak();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>假设我们想要显示之前遇到的所有小猫，我们可以通过 <code>Kitten</code>找到所有的kitten <code>documents</code>：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Kitten.find(<span class="function"><span class="keyword">function</span> (<span class="params">err, kittens</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">  <span class="built_in">console</span>.log(kittens)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>刚才我们在命令行打印了数据库中所有的kitten。如果我们想要通过name查询kitten, Mongoose 支持 MongoDB 的<em>富参数查询</em>：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Kitten.find(&#123; <span class="attr">name</span>: <span class="regexp">/^Fluff/</span> &#125;, callback)</span><br></pre></td></tr></table></figure></p>
<p>查询 <code>name</code> 字段以”Fluff”开头的 <code>doucment</code> 实例，在    <code>callback</code> 中返回结果。</p>
<p>###结束<br>快速入门已结束。我们创建了一个 <code>Schema</code>，添加了一个 <code>document</code> 方法，用 Mongoose 在 MongoDB 中保存和查询 kitten。更多请查看 guide 和 api docs。</p>
<hr>
<h2 id="导航"><a href="#导航" class="headerlink" title="导航"></a><strong>导航</strong></h2><h3 id="Schemas"><a href="#Schemas" class="headerlink" title="Schemas"></a><strong>Schemas</strong></h3><p>请确保你已看过快速入门章节再阅读本章节。</p>
<h4 id="定义Schema"><a href="#定义Schema" class="headerlink" title="定义Schema"></a><strong>定义Schema</strong></h4><p>Mongoose中一切由Schema导出。每个Schema映射到MongoDB中的集合，并以集合定义骨架文本。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="keyword">var</span> Schema = mongoose.Schema;</span><br><span class="line"><span class="keyword">var</span> blogSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  title:  <span class="built_in">String</span>,</span><br><span class="line">  author: <span class="built_in">String</span>,</span><br><span class="line">  body:   <span class="built_in">String</span>,</span><br><span class="line">  comments: [&#123; <span class="attr">body</span>: <span class="built_in">String</span>, <span class="attr">date</span>: <span class="built_in">Date</span> &#125;],</span><br><span class="line">  date: &#123; <span class="attr">type</span>: <span class="built_in">Date</span>, <span class="attr">default</span>: <span class="built_in">Date</span>.now &#125;,</span><br><span class="line">  hidden: <span class="built_in">Boolean</span>,</span><br><span class="line">  meta: &#123;</span><br><span class="line">    votes: <span class="built_in">Number</span>,</span><br><span class="line">    favs:  <span class="built_in">Number</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>每个 <code>blogSchema</code> 中的键定义的属性将会是 <code>SchemaType</code>定义的一个类型。比如，<code>title</code> 属性将会被定义成String, <code>date</code>将会被定义成data。也可以支持复杂的嵌套结构（比如上面的 <code>meta</code>）。</p>
<p>基本数据类型有：</p>
<ul>
<li>String</li>
<li>Number</li>
<li>Date</li>
<li>Buffer</li>
<li>Boolean</li>
<li>Mixed</li>
<li>ObjectId</li>
<li>Array</li>
</ul>
<p><code>Schemas</code> 不仅定义文档结构和数据类型，也可以定义实例方法，静态方法，索引，被称为中间件的文档生命周期钩子等。 </p>
<h4 id="创建Model"><a href="#创建Model" class="headerlink" title="创建Model"></a><strong>创建Model</strong></h4><p>为了使用schema定义，需要将 <code>blogSchema</code> 转化成易于工作的 <code>Model</code> 。为此，使用 <code>mongoose.model(modelName, schema)</code>方法。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Blog = mongoose.model(<span class="string">'Blog'</span>, blogSchema);</span><br><span class="line"><span class="comment">// ready to go!</span></span><br></pre></td></tr></table></figure></p>
<h4 id="实例方法-Instance-methods"><a href="#实例方法-Instance-methods" class="headerlink" title="实例方法(Instance methods)"></a><strong>实例方法(Instance methods)</strong></h4><p><code>Model</code>的实例都是 <code>document</code> , <code>document</code>有其自建的实例方法。也可以自己定义文档实例方法。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// define a schema</span></span><br><span class="line"><span class="keyword">var</span> animalSchema = <span class="keyword">new</span> Schema(&#123; <span class="attr">name</span>: <span class="built_in">String</span>, <span class="attr">type</span>: <span class="built_in">String</span> &#125;);</span><br><span class="line"><span class="comment">// assign a function to the "methods" object of our animalSchema</span></span><br><span class="line">animalSchema.methods.findSimilarTypes = <span class="function"><span class="keyword">function</span> (<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.model(<span class="string">'Animal'</span>).find(&#123; <span class="attr">type</span>: <span class="keyword">this</span>.type &#125;, cb);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在所有的Animal实例<em>都</em>有findSimilarTypes方法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Animal = mongoose.model(<span class="string">'Animal'</span>, animalSchema);</span><br><span class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Animal(&#123; <span class="attr">type</span>: <span class="string">'dog'</span> &#125;);</span><br><span class="line">dog.findSimilarTypes(<span class="function"><span class="keyword">function</span> (<span class="params">err, dogs</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(dogs); <span class="comment">// woof</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>重写默认的实例文档方法可能导致<em>不可预知</em>的结果。</p>
<h4 id="静态方法-Statics"><a href="#静态方法-Statics" class="headerlink" title="静态方法(Statics)"></a><strong>静态方法(Statics)</strong></h4><p>为 <code>model</code> 添加静态方法也同样简单：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// assign a function to the "statics" object of our animalSchema</span></span><br><span class="line">animalSchema.statics.findByName = <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.find(&#123; <span class="attr">name</span>: <span class="keyword">new</span> <span class="built_in">RegExp</span>(name, <span class="string">'i'</span>) &#125;, cb);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Animal = mongoose.model(<span class="string">'Animal'</span>, animalSchema);</span><br><span class="line">Animal.findByName(<span class="string">'fido'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, animals</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(animals);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h4 id="索引（Indexes）"><a href="#索引（Indexes）" class="headerlink" title="索引（Indexes）"></a><strong>索引（Indexes）</strong></h4><p>MongoDB支持<em>二级索引</em>,在path层或者schema层定义索引。当创建复合索引时，在schema层定义索引很有必要。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> animalSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  name: <span class="built_in">String</span>,</span><br><span class="line">  type: <span class="built_in">String</span>,</span><br><span class="line">  tags: &#123; <span class="attr">type</span>: [<span class="built_in">String</span>], <span class="attr">index</span>: <span class="literal">true</span> &#125; <span class="comment">// field level</span></span><br><span class="line">&#125;);</span><br><span class="line">animalSchema.index(&#123; <span class="attr">name</span>: <span class="number">1</span>, <span class="attr">type</span>: <span class="number">-1</span> &#125;); <span class="comment">// schema level</span></span><br></pre></td></tr></table></figure></p>
<p>当应用启动时，Mongoose为每个schema中的索引自动调用 <code>ensureIndex</code> 。为更好的开发，推荐将这项行为禁用因为索引可能导致显著的性能影响。在schema中设置 <code>autoIndex: false</code> 即可。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">animalSchema.set(<span class="string">'autoIndex'</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">new</span> Schema(&#123;..&#125;, &#123; <span class="attr">autoIndex</span>: <span class="literal">false</span> &#125;);</span><br></pre></td></tr></table></figure></p>
<h4 id="虚拟属性（Virtuals）"><a href="#虚拟属性（Virtuals）" class="headerlink" title="虚拟属性（Virtuals）"></a><strong>虚拟属性（Virtuals）</strong></h4><p>虚拟属性可以在实例文档中get、set，但不能写入数据库。getters有助于格式化、连接字段，settings有助于将一个字段去结构化成多个字段存储。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// define a schema</span></span><br><span class="line"><span class="keyword">var</span> personSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  name: &#123;</span><br><span class="line">    first: <span class="built_in">String</span>,</span><br><span class="line">    last: <span class="built_in">String</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// compile our model</span></span><br><span class="line"><span class="keyword">var</span> Person = mongoose.model(<span class="string">'Person'</span>, personSchema);</span><br><span class="line"><span class="comment">// create a document</span></span><br><span class="line"><span class="keyword">var</span> bad = <span class="keyword">new</span> Person(&#123;</span><br><span class="line">    name: &#123; <span class="attr">first</span>: <span class="string">'Walter'</span>, <span class="attr">last</span>: <span class="string">'White'</span> &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>假如要输出 <code>bad</code> 的全名，可以手动如下操作：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(bad.name.first + <span class="string">' '</span> + bad.name.last); </span><br><span class="line"><span class="comment">// Walter White</span></span><br></pre></td></tr></table></figure></p>
<p>也可以在personSchema定义一个 <code>virtual property getter</code>,这样就不用每次使用时做字符串拼接了。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">personSchema.virtual(<span class="string">'name.full'</span>).get(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name.first + <span class="string">' '</span> + <span class="keyword">this</span>.name.last;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>此时，当使用 <code>name.full</code> 属性时，将会调用getter返回结果。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'%s is insane'</span>, bad.name.full); </span><br><span class="line"><span class="comment">// Walter White is insane</span></span><br></pre></td></tr></table></figure></p>
<p>注意如果结果集被转化成object或者JSON,virtuals默认<strong>不</strong>被启用，在 <code>toObject()</code>、<code>toJSON()</code>中传入 <code>virtuals : true</code> 以启用。</p>
<p>也可以通过设置 <code>this.name.full</code> 来设置 <code>this.name.first</code> 和 <code>this.name.last</code>。比如，要分别设置 <code>bad.name.first</code>和 <code>bad.name.last</code> 为<code>&quot;Breaking&quot;</code> and <code>&quot;Bad&quot;</code> , 可做如下操作：<br>也可以在personSchema定义 <code>virtual property setters</code>：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">bad.name.full = <span class="string">'Breaking Bad'</span>;</span><br><span class="line"><span class="string">``</span><span class="string">`javascript</span></span><br><span class="line"><span class="string">personSchema.virtual('name.full').set(function (name) &#123;</span></span><br><span class="line"><span class="string">  var split = name.split(' ');</span></span><br><span class="line"><span class="string">  this.name.first = split[0];## 标题 ##</span></span><br><span class="line"><span class="string">  this.name.last = split[1];</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">mad.name.full = 'Breaking Bad';</span></span><br><span class="line"><span class="string">console.log(mad.name.first); // Breaking</span></span><br><span class="line"><span class="string">console.log(mad.name.last);  // Bad</span></span><br></pre></td></tr></table></figure></p>
<p>虚拟属性setters在数据验证之前应用，所以上面的例子在 <code>first</code>、 <code>last</code> name字段即使是必须的也能正常使用。</p>
<p>只有非虚拟属性可以作为查询和字段选择。</p>
<h4 id="可配置项（Options）"><a href="#可配置项（Options）" class="headerlink" title="可配置项（Options）"></a><strong>可配置项（Options）</strong></h4><p>schema有一系列的可被直接传入构造器或设置的可配置选项。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">new Schema(&#123;..&#125;, options);</span><br><span class="line">// or</span><br><span class="line">var schema = new Schema(&#123;..&#125;);</span><br><span class="line">schema.set(option, value);</span><br></pre></td></tr></table></figure></p>
<p>有效选项:</p>
<ul>
<li>autoIndex</li>
<li>capped</li>
<li>collection</li>
<li>id</li>
<li>_id</li>
<li>read</li>
<li>safe</li>
<li>shardKey</li>
<li>strict</li>
<li>toJSON</li>
<li>toObject</li>
<li>versionKey</li>
</ul>
<p><strong>option: autoIndex</strong><br>当应用启动时，Mongoose给每个在schema定义索引发送一个 <code>ensureIndex</code> 命令。从mongoose V3开始，索引在 <code>background</code> 默认被创建。如果你希望禁用这项自动创建的特性并想在索引被创建时手动处理，将 <code>Schemas autoIndex</code> option设置为false然后在 <code>model</code> 中使用 <code>ensureIndex</code>。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> Schema(&#123;..&#125;, &#123; <span class="attr">autoIndex</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> Clock = mongoose.model(<span class="string">'Clock'</span>, schema);</span><br><span class="line">Clock.ensureIndexes(callback);</span><br></pre></td></tr></table></figure></p>
<p><strong>option: bufferCommands</strong><br>当应用运行时 <code>autoReconnect</code>被禁用并连接到一个单个mongo实例， 此时若连接中断，<code>mongoose buffers</code> 将一直发送commands 直到你手动恢复。在如上情况下禁用 <code>mongoose buffer</code>，将其设置为false。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> Schema(&#123;..&#125;, &#123; <span class="attr">bufferCommands</span>: <span class="literal">false</span> &#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>option:capped</strong><br>mongoose支持有上限集合。为了指定这种有上限的潜在的集合,以bytwa为单位设置最大上限。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Schema(&#123;..&#125;, &#123; <span class="attr">capped</span>: <span class="number">1024</span> &#125;);</span><br></pre></td></tr></table></figure></p>
<p>如果需要传入额外的参数如 <code>max</code>, <code>autoIndexId</code>, 上限参数也可以被设置为对象,这种情况下, <code>size</code> 参数是必选的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Schema(&#123;..&#125;, &#123; <span class="attr">capped</span>: &#123; <span class="attr">size</span>: <span class="number">1024</span>, <span class="attr">max</span>: <span class="number">1000</span>, <span class="attr">autoIndexId</span>: <span class="literal">true</span> &#125; &#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>option: collection</strong><br>Mongoose默认将model name传入 <code>utils.toCollectionName</code> 以初始化集合。此方法将使model name变为复数。如需要非默认名称可以进行单独设置。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dataSchema = <span class="keyword">new</span> Schema(&#123;..&#125;, &#123; <span class="attr">collection</span>: <span class="string">'data'</span> &#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>option: id</strong><br>Mongoose默认地给每个schemas分配一个返回string类型或 <code>ObjectId</code> 形式 的<code>virtual getter</code> id，返回 <code>_id</code> 字段。如果不需要在schema中加入id getter，可以在schema创建时禁用。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// default behavior</span></span><br><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> Schema(&#123; <span class="attr">name</span>: <span class="built_in">String</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> Page = mongoose.model(<span class="string">'Page'</span>, schema);</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Page(&#123; <span class="attr">name</span>: <span class="string">'mongodb.org'</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(p.id); <span class="comment">// '50341373e894ad16347efe01'</span></span><br><span class="line"><span class="comment">// disabled id</span></span><br><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> Schema(&#123; <span class="attr">name</span>: <span class="built_in">String</span> &#125;, &#123; <span class="attr">id</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> Page = mongoose.model(<span class="string">'Page'</span>, schema);</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Page(&#123; <span class="attr">name</span>: <span class="string">'mongodb.org'</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(p.id); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></p>
<p><strong>option: _id</strong><br>若Schema构造时没有初始化，Mongoose将默认地给每个schema分配一个<code>_id</code>字段， 类型为<code>ObjectId</code>类型，与mongoDB默认行为一致。如果不需要在schema中加入id getter，可以在schema初始化时禁用。<br>请在schema创建时传入该option以阻止Mongoose创建<code>_id</code>。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// default behavior</span></span><br><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> Schema(&#123; <span class="attr">name</span>: <span class="built_in">String</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> Page = mongoose.model(<span class="string">'Page'</span>, schema);</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Page(&#123; <span class="attr">name</span>: <span class="string">'mongodb.org'</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(p); <span class="comment">// &#123; _id: '50341373e894ad16347efe01', name: 'mongodb.org' &#125;</span></span><br><span class="line"><span class="comment">// disabled _id</span></span><br><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> Schema(&#123; <span class="attr">name</span>: <span class="built_in">String</span> &#125;, &#123; <span class="attr">_id</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"><span class="comment">// Don't set _id to false after schema construction as in</span></span><br><span class="line"><span class="comment">// var schema = new Schema(&#123; name: String &#125;);</span></span><br><span class="line"><span class="comment">// schema.set('_id', false);</span></span><br><span class="line"><span class="keyword">var</span> Page = mongoose.model(<span class="string">'Page'</span>, schema);</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Page(&#123; <span class="attr">name</span>: <span class="string">'mongodb.org'</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(p); <span class="comment">// &#123; name: 'mongodb.org' &#125;</span></span><br><span class="line"><span class="comment">// MongoDB will create the _id when inserted</span></span><br><span class="line">p.save(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> handleError(err);</span><br><span class="line">  Page.findById(p, <span class="function"><span class="keyword">function</span> (<span class="params">err, doc</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> handleError(err);</span><br><span class="line">    <span class="built_in">console</span>.log(doc); <span class="comment">// &#123; name: 'mongodb.org', _id: '50341373e894ad16347efe12' &#125;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p><strong>option: read</strong><br><em>这个看不懂</em></p>
<p><strong>option: safe</strong><br>若有错误返回callback,此参数将会被传入。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> safe = &#123; <span class="attr">w</span>: <span class="string">"majority"</span>, <span class="attr">wtimeout</span>: <span class="number">10000</span> &#125;;</span><br><span class="line"><span class="keyword">new</span> Schema(&#123; .. &#125;, &#123; <span class="attr">safe</span>: safe &#125;);</span><br></pre></td></tr></table></figure></p>
<p><code>safe</code>字段默认被设置为true,以保证任何产生的错误都能返回到callback。<code>safe</code> 可如下设置 <code>{ j: 1, w: 2, wtimeout: 10000 }</code> ,设置j表示做1份日志，w表示做2个副本（尚不明确），超时时间10秒。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> safe = &#123; <span class="attr">w</span>: <span class="string">"majority"</span>, <span class="attr">wtimeout</span>: <span class="number">10000</span> &#125;;</span><br><span class="line"><span class="keyword">new</span> Schema(&#123; .. &#125;, &#123; <span class="attr">safe</span>: safe &#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>option: shardKey</strong><br>需要mongoose做分布式处理才会用到该属性。每个分布的集合分配一个必须在insert/update操作时传输的分布秘钥。只需设置schema option为同一个分布秘钥即可。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Schema(&#123; .. &#125;, &#123; <span class="attr">shardKey</span>: &#123; <span class="attr">tag</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="number">1</span> &#125;&#125;)</span><br></pre></td></tr></table></figure></p>
<p><strong>option: strict</strong><br>默认开启strict option,用于保证传入model构造器中不准确的值不会被写入数据库。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> thingSchema = <span class="keyword">new</span> Schema(&#123;..&#125;)</span><br><span class="line"><span class="keyword">var</span> Thing = mongoose.model(<span class="string">'Thing'</span>, thingSchema);</span><br><span class="line"><span class="keyword">var</span> thing = <span class="keyword">new</span> Thing(&#123; <span class="attr">iAmNotInTheSchema</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">thing.save(); <span class="comment">// iAmNotInTheSchema is not saved to the db</span></span><br><span class="line"><span class="comment">// set to false..</span></span><br><span class="line"><span class="keyword">var</span> thingSchema = <span class="keyword">new</span> Schema(&#123;..&#125;, &#123; <span class="attr">strict</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> thing = <span class="keyword">new</span> Thing(&#123; <span class="attr">iAmNotInTheSchema</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">thing.save(); <span class="comment">// iAmNotInTheSchema is now saved to the db!!</span></span><br></pre></td></tr></table></figure></p>
<p>这同样影响 <code>doc.set()</code> 方法。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> thingSchema = <span class="keyword">new</span> Schema(&#123;..&#125;)</span><br><span class="line"><span class="keyword">var</span> Thing = mongoose.model(<span class="string">'Thing'</span>, thingSchema);</span><br><span class="line"><span class="keyword">var</span> thing = <span class="keyword">new</span> Thing;</span><br><span class="line">thing.set(<span class="string">'iAmNotInTheSchema'</span>, <span class="literal">true</span>);</span><br><span class="line">thing.save(); <span class="comment">// iAmNotInTheSchema is not saved to the db</span></span><br></pre></td></tr></table></figure></p>
<p>该参数可设置boolean值在model实例层重写。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Thing = mongoose.model(<span class="string">'Thing'</span>);</span><br><span class="line"><span class="keyword">var</span> thing = <span class="keyword">new</span> Thing(doc, <span class="literal">true</span>);  <span class="comment">// enables strict mode</span></span><br><span class="line"><span class="keyword">var</span> thing = <span class="keyword">new</span> Thing(doc, <span class="literal">false</span>); <span class="comment">// disables strict mode</span></span><br></pre></td></tr></table></figure></p>
<p>该参数也可被设为<code>&quot;throw&quot;</code>,此时传入错误的数据将会报错。<br><em>注意：<strong>不要</strong>设置为false,除非有适当的理由。</em><br><em>注意：任何在实例中的设置的不存在于schema中的key/val将会被忽略，无视该参数。</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> thingSchema = <span class="keyword">new</span> Schema(&#123;..&#125;)</span><br><span class="line"><span class="keyword">var</span> Thing = mongoose.model(<span class="string">'Thing'</span>, thingSchema);</span><br><span class="line"><span class="keyword">var</span> thing = <span class="keyword">new</span> Thing;</span><br><span class="line">thing.iAmNotInTheSchema = <span class="literal">true</span>;</span><br><span class="line">thing.save(); <span class="comment">// iAmNotInTheSchema is never saved to the db</span></span><br></pre></td></tr></table></figure></p>
<p><strong>option: toJSON</strong><br>和 <code>toObject</code>option 类似，但只在document.toString 被调用时起作用。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> Schema(&#123; <span class="attr">name</span>: <span class="built_in">String</span> &#125;);</span><br><span class="line">schema.path(<span class="string">'name'</span>).get(<span class="function"><span class="keyword">function</span> (<span class="params">v</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> v + <span class="string">' is my name'</span>;</span><br><span class="line">&#125;);</span><br><span class="line">schema.set(<span class="string">'toJSON'</span>, &#123; <span class="attr">getters</span>: <span class="literal">true</span>, <span class="attr">virtuals</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> M = mongoose.model(<span class="string">'Person'</span>, schema);</span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">new</span> M(&#123; <span class="attr">name</span>: <span class="string">'Max Headroom'</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(m.toObject()); <span class="comment">// &#123; _id: 504e0cd7dd992d9be2f20b6f, name: 'Max Headroom' &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(m.toJSON()); <span class="comment">// &#123; _id: 504e0cd7dd992d9be2f20b6f, name: 'Max Headroom is my name' &#125;</span></span><br><span class="line"><span class="comment">// since we know toJSON is called whenever a js object is stringified:</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(m)); <span class="comment">// &#123; "_id": "504e0cd7dd992d9be2f20b6f", "name": "Max Headroom is my name" &#125;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>option: toObject</strong><br><code>document.toObject</code> 可以将mongoose document转化为JavaScript对象。<br>该方法接受一系列参数。可以将参数定义在schema以默认地在schema产生的document中接受这些参数，而不是给每个document传入参数。<br>设置 <code>getters: true</code> 以使 <code>viturals</code> 也能在 <code>console.log</code> 中输出。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> Schema(&#123; <span class="attr">name</span>: <span class="built_in">String</span> &#125;);</span><br><span class="line">schema.path(<span class="string">'name'</span>).get(<span class="function"><span class="keyword">function</span> (<span class="params">v</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> v + <span class="string">' is my name'</span>;</span><br><span class="line">&#125;);</span><br><span class="line">schema.set(<span class="string">'toObject'</span>, &#123; <span class="attr">getters</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> M = mongoose.model(<span class="string">'Person'</span>, schema);</span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">new</span> M(&#123; <span class="attr">name</span>: <span class="string">'Max Headroom'</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(m); <span class="comment">// &#123; _id: 504e0cd7dd992d9be2f20b6f, name: 'Max Headroom is my name' &#125;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>option: versionKey</strong><br>每个doucment被创建时会写入<code>versionKey</code>。此值包括该document内置的修订。该document属性的name是可配置的。默认的是 <code>_v</code>。如果与你的应用冲突了，你可以如下配置：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> Schema(&#123; <span class="attr">name</span>: <span class="string">'string'</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> Thing = mongoose.model(<span class="string">'Thing'</span>, schema);</span><br><span class="line"><span class="keyword">var</span> thing = <span class="keyword">new</span> Thing(&#123; <span class="attr">name</span>: <span class="string">'mongoose v3'</span> &#125;);</span><br><span class="line">thing.save(); <span class="comment">// &#123; __v: 0, name: 'mongoose v3' &#125;</span></span><br><span class="line"><span class="comment">// customized versionKey</span></span><br><span class="line"><span class="keyword">new</span> Schema(&#123;..&#125;, &#123; <span class="attr">versionKey</span>: <span class="string">'_somethingElse'</span> &#125;)</span><br><span class="line"><span class="keyword">var</span> Thing = mongoose.model(<span class="string">'Thing'</span>, schema);</span><br><span class="line"><span class="keyword">var</span> thing = <span class="keyword">new</span> Thing(&#123; <span class="attr">name</span>: <span class="string">'mongoose v3'</span> &#125;);</span><br><span class="line">thing.save(); <span class="comment">// &#123; _somethingElse: 0, name: 'mongoose v3' &#125;</span></span><br></pre></td></tr></table></figure></p>
<p>document版本控制也可设置为 <code>false</code> 禁用,<strong><em>不要</em></strong> 禁用该option， <em>除非你知道你在做什么</em>。</p>
<hr>
<h3 id="Models"><a href="#Models" class="headerlink" title="Models"></a><strong>Models</strong></h3><p>Models是由schema定义编译的假想的构造器，document表示Models的实例，可被存入数据库或从数据库恢复。所有数据库操作都是由model处理。</p>
<h4 id="编译model"><a href="#编译model" class="headerlink" title="编译model"></a><strong>编译model</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> mongoose.Schema(&#123; <span class="attr">name</span>: <span class="string">'string'</span>, <span class="attr">size</span>: <span class="string">'string'</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> Tank = mongoose.model(<span class="string">'Tank'</span>, schema);</span><br></pre></td></tr></table></figure>
<h4 id="生成document"><a href="#生成document" class="headerlink" title="生成document"></a><strong>生成document</strong></h4><p>document是model的实例。创建doc并存入数据库是简单的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Tank = mongoose.model(<span class="string">'Tank'</span>, yourSchema);</span><br><span class="line"><span class="keyword">var</span> small = <span class="keyword">new</span> Tank(&#123; <span class="attr">size</span>: <span class="string">'small'</span> &#125;);</span><br><span class="line">small.save(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> handleError(err);</span><br><span class="line">  <span class="comment">// saved!</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">Tank.create(&#123; <span class="attr">size</span>: <span class="string">'small'</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err, small</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> handleError(err);</span><br><span class="line">  <span class="comment">// saved!</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>注意未打开连接的话任何tanks将不会被创建/删除。这种情况下，使用 <code>mongoose.model()</code> ,现在打开连接：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongoose.connect(<span class="string">'localhost'</span>, <span class="string">'gettingstarted'</span>);</span><br></pre></td></tr></table></figure></p>
<p><strong>查询</strong><br>用Mongoose查询很简单，mongoose支持MongoDB的富参数查询。可以使用<code>models</code>静态方法 <code>find</code> , <code>findById</code> , <code>findOne</code> , or  <code>where</code> 。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tank.find(&#123; <span class="attr">size</span>: <span class="string">'small'</span> &#125;).where(<span class="string">'createdDate'</span>).gt(oneYearAgo).exec(callback);</span><br></pre></td></tr></table></figure></p>
<p><strong>删除</strong><br><code>model.remove</code> 静态方法可删除满足<code>contitions</code>的所有文档。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Tank.remove(&#123; <span class="attr">size</span>: <span class="string">'large'</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> handleError(err);</span><br><span class="line">  <span class="comment">// removed!</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>更新</strong><br>每个model有其自身的 <code>update</code> 方法用于在数据库中修改文档，无需将其返回你的应用。</p>
<hr>
<h3 id="Documents"><a href="#Documents" class="headerlink" title="Documents"></a><strong>Documents</strong></h3><p>Mongoose documents是存储于MongoDB中的点对点映射。每个document都是model的一个实例。<br><strong>查询</strong><br>有很多方法可以从MongoDB检索文档。详情见querying章节。</p>
<p><strong>更新</strong><br>有很多种方式可以更新docments。下面是一种用 <code>findById</code> 的传统的方式：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Tank.findById(id, <span class="function"><span class="keyword">function</span> (<span class="params">err, tank</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> handleError(err);</span><br><span class="line">  </span><br><span class="line">  tank.size = <span class="string">'large'</span>;</span><br><span class="line">  tank.save(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> handleError(err);</span><br><span class="line">    res.send(tank);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>这个方法找到了mongo中第一条document，然后分配一个 <code>save</code> 命令。但是，如果我们不需要返回在应用中返回document，而是直接在数据库中直接更新属性。可以使用 <code>model.uopdate()</code> 。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tank.update(&#123; <span class="attr">_id</span>: id &#125;, &#123; <span class="attr">$set</span>: &#123; <span class="attr">size</span>: <span class="string">'large'</span> &#125;&#125;, callback);</span><br></pre></td></tr></table></figure></p>
<p>如果需要返回document，可以使用：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Tank.findByIdAndUpdate(id, &#123; <span class="attr">$set</span>: &#123; <span class="attr">size</span>: <span class="string">'large'</span> &#125;&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err, tank</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> handleError(err);</span><br><span class="line">  res.send(tank);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>验证</strong><br>文档在存储之前验证。<br><code>findAndUpdate/Remove</code> 静态方法对至少一个document进行操作，然后只调用一次返回结果。</p>
<hr>
<h3 id="Sub-Docs"><a href="#Sub-Docs" class="headerlink" title="Sub Docs"></a><strong>Sub Docs</strong></h3><p>嵌套文档是由已有schema创建的文档的集合。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> childSchema = <span class="keyword">new</span> Schema(&#123; <span class="attr">name</span>: <span class="string">'string'</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> parentSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  children: [childSchema]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>嵌套文档和普通文档有着相同的特性。唯一的不同是嵌套文档不是单独的被存储，而是父元素存储时才被存储。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Parent = mongoose.model(<span class="string">'Parent'</span>, parentSchema);</span><br><span class="line"><span class="keyword">var</span> parent = <span class="keyword">new</span> Parent(&#123; <span class="attr">children</span>: [&#123; <span class="attr">name</span>: <span class="string">'Matt'</span> &#125;, &#123; <span class="attr">name</span>: <span class="string">'Sarah'</span> &#125;] &#125;)</span><br><span class="line">parent.children[<span class="number">0</span>].name = <span class="string">'Matthew'</span>;</span><br><span class="line">parent.save(callback);</span><br></pre></td></tr></table></figure></p>
<p>如果在嵌套文档的中间件发生了错误，它将会冒泡到父元素的callback,此时error handling 被中断了。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">childSchema.pre(<span class="string">'save'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'invalid'</span> == <span class="keyword">this</span>.name) <span class="keyword">return</span> next(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'#sadpanda'</span>));</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> parent = <span class="keyword">new</span> Parent(&#123; <span class="attr">children</span>: [&#123; <span class="attr">name</span>: <span class="string">'invalid'</span> &#125;] &#125;);</span><br><span class="line">parent.save(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err.message) <span class="comment">// #sadpanda</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p><strong>找到嵌套文档</strong><br>每个文档有一个 <code>_id</code>。文档集合有特殊的id方法用于查找他的 <code>_id</code> 。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> doc = parent.children.id(id);</span><br></pre></td></tr></table></figure></p>
<p><strong>添加嵌套文档</strong><br>MongooseArray方法， <code>push</code> 、 <code>unshift</code> 、<code>addToSet</code>等显式地向合适的类型中注入参数。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Parent = mongoose.model(<span class="string">'Parent'</span>);</span><br><span class="line"><span class="keyword">var</span> parent = <span class="keyword">new</span> Parent;</span><br><span class="line"><span class="comment">// create a comment</span></span><br><span class="line">parent.children.push(&#123; <span class="attr">name</span>: <span class="string">'Liesl'</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> subdoc = parent.children[<span class="number">0</span>];</span><br><span class="line"><span class="built_in">console</span>.log(subdoc) <span class="comment">// &#123; _id: '501d86090d371bab2c0341c5', name: 'Liesl' &#125;</span></span><br><span class="line">subdoc.isNew; <span class="comment">// true</span></span><br><span class="line">parent.save(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> handleError(err)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Success!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>嵌套文档也可以通过MongooseArrays的 <code>create</code> 方法进行创建。<br><strong>删除嵌套文档</strong><br>每个嵌套文档有自身的 <code>remove</code> 方法。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> doc = parent.children.id(id).remove();</span><br><span class="line">parent.save(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> handleError(err);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'the sub-doc was removed'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="Queries"><a href="#Queries" class="headerlink" title="Queries"></a><strong>Queries</strong></h3><p>文档可被models的若干静态方法查询。<br>任何带有准确查询条件的model方法有两种执行方式：<br>当callback：</p>
<ul>
<li>被传入时，当结果返回callback时方法将会被立即执行。</li>
<li>未传入时，会返回一个提供特殊接口 <code>QueryBuilder</code> 的 <code>Query</code> 实例。</li>
</ul>
<p>看看传入callback时发生了什么：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = mongoose.model(<span class="string">'Person'</span>, yourSchema);</span><br><span class="line"><span class="comment">// find each person with a last name matching 'Ghost', selecting the `name` and `occupation` fields</span></span><br><span class="line">Person.findOne(&#123; <span class="string">'name.last'</span>: <span class="string">'Ghost'</span> &#125;, <span class="string">'name occupation'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, person</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> handleError(err);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'%s %s is a %s.'</span>, person.name.first, person.name.last, person.occupation) <span class="comment">// Space Ghost is a talk show host.</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>现在可知查询被立刻执行，然后结果返回callback。mongoose中的callback使用如下参数 callback(error, result)。如果查询时发生错误， <code>error</code> 参数将包含一个错误文档，<code>result</code> 将会是null。如果查询成功， <code>error</code> 将会是null,而 <code>result</code> 将会是查询的结果的填充。</p>
<p>只要是在queryz中传入了callback, callback就遵循如下模式 <code>callback(error, result)</code>。  <code>result</code>取决于方法： <code>findOne</code> 是单个潜在的空文档， <code>find()</code> 是文档集合， <code>count</code> 是文档数量， <code>update</code> 是影响的文档数。</p>
<p>看看未传入callback时发生了什么：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// find each person with a last name matching 'Ghost'</span></span><br><span class="line"><span class="keyword">var</span> query = Person.findOne(&#123; <span class="string">'name.last'</span>: <span class="string">'Ghost'</span> &#125;);</span><br><span class="line"><span class="comment">// selecting the `name` and `occupation` fields</span></span><br><span class="line">query.select(<span class="string">'name occupation'</span>);</span><br><span class="line"><span class="comment">// execute the query at a later time</span></span><br><span class="line">query.exec(<span class="function"><span class="keyword">function</span> (<span class="params">err, person</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> handleError(err);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'%s %s is a %s.'</span>, person.name.first, person.name.last, person.occupation) <span class="comment">// Space Ghost is a talk show host.</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>返回的 <code>Query</code> 允许进行链式查询。深入的例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Person</span><br><span class="line">.find(&#123; <span class="attr">occupation</span>: <span class="regexp">/host/</span> &#125;)</span><br><span class="line">.where(<span class="string">'name.last'</span>).equals(<span class="string">'Ghost'</span>)</span><br><span class="line">.where(<span class="string">'age'</span>).gt(<span class="number">17</span>).lt(<span class="number">66</span>)</span><br><span class="line">.where(<span class="string">'likes'</span>).in([<span class="string">'vaporizing'</span>, <span class="string">'talking'</span>])</span><br><span class="line">.limit(<span class="number">10</span>)</span><br><span class="line">.sort(<span class="string">'-occupation'</span>)</span><br><span class="line">.select(<span class="string">'name occupation'</span>)</span><br><span class="line">.exec(callback);</span><br></pre></td></tr></table></figure></p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2016/08/05/promise用法/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Feng's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        714496183@qq.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="714496183@qq.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2018/01/">一月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>(　ﾟ∀ﾟ) ﾉ♡
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->


    <script>lsloader.load("js/lazyload.min.js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==")</script>
    <script>lsloader.load("js/js.min.js","/js/js.min.js?oAl/+lvaqTFV31JXTmbrNA==")</script>



    <script>lsloader.load("js/nprogress.js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==")</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Window Load-->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Bing Background -->


<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.4.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
